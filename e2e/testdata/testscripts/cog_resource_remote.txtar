[!remote] skip

env KOGEN_CACHE_DIR=$WORK/cache
! exists $WORK/cache/resources/a40cbb1a68216175.yaml

exec kogen build kogen.cue
cmp stdout golden.yaml

# It should be cached now.
exists $WORK/cache/resources/a40cbb1a68216175.yaml

# It should work with the cache there
exec kogen build kogen.cue
cmp stdout golden.yaml

-- kogen.cue --
package kube

kogen: nginx: {
    apiVersion: "kogen.internal/v1alpha1"
    kind: "Cog"
    spec: {
        resource: ["https://raw.githubusercontent.com/kubernetes/examples/master/web/guestbook/frontend-service.yaml"]
    }
}

-- golden.yaml --
apiVersion: v1
kind: Service
metadata:
  labels:
    app: guestbook
    tier: frontend
  name: frontend
spec:
  ports:
  - port: 80
  selector:
    app: guestbook
    tier: frontend
  type: NodePort
