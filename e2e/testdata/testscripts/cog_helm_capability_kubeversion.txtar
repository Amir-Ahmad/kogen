exec kogen build no-capability.cue
stdout ''

exec kogen build with-capability.cue
cmp stdout golden.yaml

-- no-capability.cue --
package kube

kogen: main: {
	apiVersion: "kogen.internal/v1alpha1"
	kind:       "Cog"

	spec: helm: [{
		releaseName: "hello"
		repository:  "chart/"
		chartName:   "hello"
		version:     "0.1.0"
    }]
}

-- with-capability.cue --
package kube

kogen: main: {
	apiVersion: "kogen.internal/v1alpha1"
	kind:       "Cog"

	spec: helm: [{
		releaseName: "hello"
		repository:  "chart/"
		chartName:   "hello"
		version:     "0.1.0"
    }]
	spec: helmOptions: kubeVersion: "1.31.0"
}

-- chart/Chart.yaml --
apiVersion: v2
name: hello
version: 0.1.0

-- chart/templates/configmap.yaml --
{{- if semverCompare ">=1.30.0" .Capabilities.KubeVersion.Version }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: hello-config
data:
  hello: world
{{- end }}

-- golden.yaml --
apiVersion: v1
data:
  hello: world
kind: ConfigMap
metadata:
  name: hello-config
