# Test multiple SOPS files in different fields
env SOPS_AGE_KEY='AGE-SECRET-KEY-1V9ES5TS93UMLDT9QF2MGPG5K6AVVY7CERD9RMMX4L4Y2WMADVXAQV8JLX3'

exec kogen build ./...
cmp stdout golden.yaml

-- secrets_one.sops.yaml --
token1: ENC[AES256_GCM,data:706nwot/8ZuMRlQpnQ==,iv:whFLVXStJufp/J2+HD6aaAc//+3czaxF/E12h78oGpc=,tag:CuFA133paYwEt+IoBbVtFA==,type:str]
sops:
    age:
        - recipient: age1uurkx954mg2d3y5tmgduytg28fdlwhynmhp6ph8e5kw7j3mz7e8q45mefs
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBobTZILzJKY24xdzFKZ3BJ
            WCs2K3FrbVFSSE10UGNiRlFLOE9hbENIZUM0CnA1aTV4cXE4bkJEWko3byttVFFG
            RUY4cXNPQXdVdERGR1RCTExweTVtVzQKLS0tIFR5eG1UUUsrQmNCQmNGZ2lpWjBy
            dmJYTDJrdzdFUzh6cGZGZFNvQkUxN3cK3kOQtZPC3nNkZXX1+U8MIV7o3hmob2GW
            TM7U7WzGsMASBw//2BXMvQM5207cB5a6NALKr8cPHmr4w8BR0lLJ9w==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-10-05T00:09:22Z"
    mac: ENC[AES256_GCM,data:xXZHH7CUh5usmW59rnnJZelFPu65T3tmJ20t6TiOpxp8Q2KK8dIS5jwmOAvz8GEQyGHeR9vp3GzXy2ACSaF5mk6J7I7iEt6x2rAimjtSMu1wQtC4l50we38k62ww8h37O0I/ut5XaHUMAsx7kXzPEhvve/VgDeUJKWHpdX9SM84=,iv:1Uj4R30d9mTb1/tkdrnTjUPitYAwIyYqKWjt17c7Z88=,tag:KFrnyx2b1PacGMkT8gUrZw==,type:str]
    unencrypted_suffix: _unencrypted
    version: 3.10.2

-- secrets_two.sops.yaml --
token2: ENC[AES256_GCM,data:KCbXQU/wch9wiP0=,iv:/zDlA/U6MujsmT7F0pJx0YxTVkWVQ5RzCRoxrHpr5xs=,tag:chRdRr+ME7X/EiXL+ZxINQ==,type:str]
sops:
    age:
        - recipient: age1uurkx954mg2d3y5tmgduytg28fdlwhynmhp6ph8e5kw7j3mz7e8q45mefs
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBBeTRKb20xTW9Ma1orMWlZ
            c0xGK3B0RE5hd0Rick1EWUJqTFI0QzllbVZnClVITnZmOWNtU2xFQ2ZTeUVMQ3A3
            VzF1RU9hUzNrbkcyRnhSd2lvY0syRzQKLS0tIEZ2Nk5JblNVd1kzaW9nQ29UbUlt
            Ni92Tm5QU0RQWGdHVWh1S2M1ZjNnL0EKuZ+nIqOg2CvHIURRnTy0YRLRQaH4vA+E
            qW/DBaMPlQFc+kds4yEM85Fvyyb5MZT8mIc/Uz1kdvVuJ+2ytQ/lDQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-10-05T00:09:29Z"
    mac: ENC[AES256_GCM,data:7BKtjzdZh53uRjsZqs4/vwZ2F90rEej1M3wownbI1OjXUzj0FYiHhga6W6t5E5DveSpesw46M6EwXqQfbIHLtIXsqZGt46SjLicP7pfqTyHlTNK6xWEdRXDWonwtIrH45NZ/VVl4U5DgJXnzouZRs2qBKqO8FQkfWe4FNvNdZYE=,iv:ByvFyfhp+SLxatosYe57ffUb3ZbTirwlxv5b/zD8Ik0=,tag:87BDsEVHcaXnltBzzPW9Mw==,type:str]
    unencrypted_suffix: _unencrypted
    version: 3.10.2

-- kogen.cue --
package kube

secrets: {
    one: _ @sops(secrets_one.sops.yaml)
    two: _ @sops(secrets_two.sops.yaml)
}

kogen: foobar: {
    apiVersion: "kogen.internal/v1alpha1"
    kind: "Objects"
    spec: objects: [
        {
            apiVersion: "v1"
            kind: "Secret"
            metadata: name: "tokens"
            stringData: {
                token1: secrets.one.token1
                token2: secrets.two.token2
            }
        },
    ]
}

-- golden.yaml --
apiVersion: v1
kind: Secret
metadata:
  name: tokens
stringData:
  token1: abcdef_123456
  token2: ghijkl_7890
